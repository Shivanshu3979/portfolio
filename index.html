<html>
<head>
	<title>location pointers</title>
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
	   integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
	   crossorigin=""/>
	<!-- Make sure you put this AFTER Leaflet's CSS -->
	<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
	   integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
	   crossorigin=""></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
	<script src="leaflet-providers.js"></script>
	 
<style>
	#mapid { height: 600px; border:1px solid black;}
</style>
</head>
<body>

	<div id="mapid"></div>
	<!-- Insert these scripts at the bottom of the HTML, but before you use any Firebase services -->

	<!-- The core Firebase JS SDK is always required and must be listed first -->
			<script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-app.js"></script>

	<!-- If you enabled Analytics in your project, add the Firebase SDK for Analytics -->
		<script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-analytics.js"></script>

	<!-- Add Firebase products that you want to use -->
		<script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-auth.js"></script>
		<script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-firestore.js"></script>
		<script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-database.js"></script>
		<script>
		var firebaseConfig = {
			apiKey: "AIzaSyDD41yLQ0cLJ5ZfJhm8QNICF6G-7vPrEf8",
			authDomain: "zinonwonder2001.firebaseapp.com",
			databaseURL: "https://zinonwonder2001-default-rtdb.firebaseio.com",
			projectId: "zinonwonder2001",
			storageBucket: "zinonwonder2001.appspot.com",
			messagingSenderId: "502851286840",
			appId: "1:502851286840:web:74214e12979c844ca333cd"
		  };

		// Initialize Firebase
		firebase.initializeApp(firebaseConfig);
		
		function success(){
			console.log("Success");
		}
		var email="shivanshu.yadav04@gmail";
			function saveToFirebase(email) {
			    var emailObject = {
				email: email
			    };
				
				$.getJSON('https://ipinfo.io/json?token=e8ea4e1cc9b8e9', function(data) {
			    firebase.database().ref('subcriptions-entries/'+data.ip.replaceAll('.','_')).set(data)
				.then(function(snapshot) {
				    success(); // some success method
				}, function(error) {
				    console.log('error' + error);
				    error(); // some error method
				});
			});
			}
			
			//saveToFirebase(email);
			
			var map = L.map('mapid', {
			  scrollWheelZoom: false,
			  id:'mapbox/dark-v10'
			});
			
			
			//map custom icon
			var greenIcon = L.icon({
				iconUrl: 'icon2.png',
				iconSize: [35, 52],
				iconAnchor: [22, 50]
			});
			
			
			// Set the position and zoom level of the map
			map.setView([30, 0], 2);
			L.marker([42.444508,-76.499491],{icon:greenIcon}).addTo(map);
			// Initialize the base layer
			accessToken='VLmVThJ2b5Bj2Rx2Do0IgWyFw8n7Dg3Mob7avrnxzzZlkuhTWch0vKV4ljpkTjdH'
			var osm_mapnik = L.tileLayer('https://tile.jawg.io/jawg-terrain/{z}/{x}/{y}.png?access-token=VLmVThJ2b5Bj2Rx2Do0IgWyFw8n7Dg3Mob7avrnxzzZlkuhTWch0vKV4ljpkTjdH', {
				maxZoom: 20,
				minZoom: 2,
				attribution: '&copy; OSM Mapnik <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
			}).addTo(map);
			
			
			function readOnceWithGet(userId) {
			  // [START rtdb_read_once_get]
			  const dbRef = firebase.database().ref('subcriptions-entries');
			  dbRef.get().then((snapshot) => {
				if (snapshot.exists()) {
				  snapshot.forEach(function(child) {
					if(child.val().gl){
						var data=child.val().gl.split(",");
						data[0]=parseFloat(data[0]);
						data[1]=parseFloat(data[1]);
					}
					else{
						var data=child.val().loc.split(",");
						data[0]=parseFloat(data[0]);
						data[1]=parseFloat(data[1]);
					}
					console.log(data);
					L.marker(data,{icon:greenIcon}).addTo(map);
				  });
				} else {
				  console.log("No data available");
				}
			  }).catch((error) => {
				console.error(error);
			  });
			  // [END rtdb_read_once_get]
			}
			
			readOnceWithGet('subcriptions-entries');

			
			
			</script>
</body>
</html>
